<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <script src="https://unpkg.com/axios/dist/axios.min.js"></script>

</head>

<body id="bodyNode">

  <p id="text">hello world</p>
  <button id="btn" onclick="start()">开始请求</button>
  <button id="btn" onclick="stop()">停止</button>
</body>
<script>
  const instance = axios.create({
    baseURL: 'http://127.0.0.1:3000/',
    timeout: 30000,
    headers: {
      'Content-Type': 'application/x-www-form-urlencoded',
    },
  });
  // 设置 axios 实例默认配置
  instance.defaults.headers.common['Authorization'] = '';
  instance.defaults.headers.post['Content-Type'] = 'application/json; charset=UTF-8';

  // 自定义请求拦截器
  instance.interceptors.request.use(config => {
    const token = window.localStorage.getItem('token');
    token && (config.headers['Authorization'] = token);
    return config;
  }, error => Promise.reject(error));

  // 自定义响应拦截器
  instance.interceptors.response.use(response => {
    if (response.status === 200) {
      return Promise.resolve(response.data);
    }

    return Promise.reject(response);
  }, error => Promise.reject(error));


  const CancelToken = axios.CancelToken;
  let cancel;
  function start() {
    instance.post('/cancel', {
      name: 'new name',
      phone: 'new phone',
    }, {
      // CancelToken 构造函数接收一个 executor 函数参数，并且该函数接收一个取消函数 c 用于取消该次请求
      cancelToken: new CancelToken(function executor(c) {
        // 将取消函数赋值到外部变量，方便从外部取消请求
        cancel = c;
        console.log(c);
      }),
    });
  }
  // 手动取消请求
  function stop() {
    cancel('取消了');
  }
</script>

</html>