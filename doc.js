const fs = require("fs");
const path = require("path");
const PDFDocument = require("pdfkit");
const SVGtoPDF = require("./public/svg-to-pdfkit.js");

function init() {
  PDFDocument.prototype.addSVG = function (svg, x, y, options) {
    return SVGtoPDF(this, svg, x, y, options);
  };
}
function pdf() {
  // 创建 PDF 文档
  const doc = new PDFDocument({
    pdfVersion: "1.4",
  });
  doc.addSpotColor("RDG_GLOSS", 50, 25, 25, 0);
  doc.addSpotColor("RDG_WHITE", 25, 25, 25, 25);
  doc.fillColor("RDG_GLOSS").text("you text here");
  // const randomName = Math.random().toString(36).substring(3);
  const fontPath = path.join(__dirname, "assets/NotoSansCJK-Regular.ttf");
  // doc.registerFont("my-font", fontPath, "my-font-regular");
  const outputName = `svg-pdf.pdf`;
  const writeStream = fs.createWriteStream(outputName);

  doc.pipe(writeStream);
  {
    /* <path fill="RDG_GLOSS" d="M150 0 L75 200 L225 200 Z" /> */
  }

  const mockSvgImg = `
<svg xmlns="http://www.w3.org/2000/svg" width="50.0062mm" height="41.9805mm"
 viewBox="0.07999991999999999 -4.0999959 50.0062 41.9805" transform="rotate(0,0,0) translate(61.2711811125897, 78.0611023678817)" fill="#191919">
      
                  <g transform="translate(12.135112868000004,0)">
                      <path transform="translate(0,0)"  d="M 1.328 0 L 0.991999 0 L 0.991999 -1.064 L 0.08 -2.8 L 0.46 -2.8 L 1.212 -1.284 L 1.112 -1.284 L 1.86 -2.8 L 2.236 -2.8 L 1.328 -1.064 L 1.328 0 Z M 3.152 0.048 L 3.152 0.048 Q 2.872 0.048 2.648 -0.082 Q 2.424 -0.212 2.296 -0.45 Q 2.168 -0.687999 2.168 -1.004 L 2.168 -1.004 Q 2.168 -1.328 2.298 -1.566 Q 2.428 -1.804 2.654 -1.934 Q 2.88 -2.064 3.16 -2.064 L 3.16 -2.064 Q 3.448 -2.064 3.67 -1.934 Q 3.892 -1.804 4.022 -1.566 Q 4.152 -1.328 4.152 -1.008 L 4.152 -1.008 Q 4.152 -0.687999 4.02 -0.45 Q 3.888 -0.212 3.664 -0.082 Q 3.44 0.048 3.152 0.048 Z M 3.156 -0.24 L 3.156 -0.24 Q 3.328 -0.24 3.476 -0.326 Q 3.624 -0.412 3.716 -0.583999 Q 3.808 -0.755999 3.808 -1.008 L 3.808 -1.008 Q 3.808 -1.264 3.718 -1.434 Q 3.628 -1.604 3.482 -1.69 Q 3.336 -1.776 3.16 -1.776 L 3.16 -1.776 Q 2.992 -1.776 2.842 -1.69 Q 2.692 -1.604 2.602 -1.434 Q 2.512 -1.264 2.512 -1.008 L 2.512 -1.008 Q 2.512 -0.755999 2.602 -0.583999 Q 2.692 -0.412 2.838 -0.326 Q 2.984 -0.24 3.156 -0.24 Z M 5.356 0.048 L 5.356 0.048 Q 5.12399 0.048 4.95 -0.044 Q 4.77599 -0.136 4.68199 -0.328 Q 4.588 -0.519999 4.588 -0.807999 L 4.588 -0.807999 L 4.588 -2.016 L 4.924 -2.016 L 4.924 -0.843999 Q 4.924 -0.543999 5.05599 -0.392 Q 5.18799 -0.24 5.428 -0.24 L 5.428 -0.24 Q 5.59599 -0.24 5.73199 -0.322 Q 5.86799 -0.404 5.94599 -0.557999 Q 6.02399 -0.711999 6.02399 -0.939999 L 6.02399 -0.939999 L 6.02399 -2.016 L 6.35999 -2.016 L 6.35999 0 L 6.05599 0 L 6.03599 -0.352 L 6.03599 -0.352 Q 5.94399 -0.164 5.76399 -0.058 Q 5.58399 0.048 5.356 0.048 Z M 7.25199 0 L 6.91599 0 L 6.91599 -2.016 L 7.21999 -2.016 L 7.24399 -1.632 L 7.24399 -1.632 Q 7.31199 -1.768 7.41799 -1.864 Q 7.52399 -1.96 7.67399 -2.012 Q 7.82399 -2.064 8.01599 -2.064 L 8.01599 -2.064 L 8.01599 -1.712 L 7.89199 -1.712 Q 7.76399 -1.712 7.64799 -1.678 Q 7.53199 -1.644 7.44199 -1.568 Q 7.35199 -1.492 7.30199 -1.362 Q 7.25199 -1.232 7.25199 -1.04 L 7.25199 -1.04 L 7.25199 0 Z M 10.564 0 L 10.252 0 Q 10.072 0 9.93999 -0.056 Q 9.80799 -0.112 9.73799 -0.246 Q 9.66799 -0.38 9.66799 -0.607999 L 9.66799 -0.607999 L 9.66799 -1.732 L 9.31599 -1.732 L 9.31599 -2.016 L 9.66799 -2.016 L 9.71199 -2.504 L 10.004 -2.504 L 10.004 -2.016 L 10.588 -2.016 L 10.588 -1.732 L 10.004 -1.732 L 10.004 -0.607999 Q 10.004 -0.42 10.08 -0.354 Q 10.156 -0.288 10.348 -0.288 L 10.348 -0.288 L 10.564 -0.288 L 10.564 0 Z M 11.856 0.048 L 11.856 0.048 Q 11.576 0.048 11.356 -0.084 Q 11.136 -0.216 11.012 -0.454 Q 10.888 -0.691999 10.888 -1.008 L 10.888 -1.008 Q 10.888 -1.328 11.01 -1.564 Q 11.132 -1.8 11.354 -1.932 Q 11.576 -2.064 11.864 -2.064 L 11.864 -2.064 Q 12.16 -2.064 12.368 -1.932 Q 12.576 -1.8 12.686 -1.586 Q 12.796 -1.372 12.796 -1.116 L 12.796 -1.116 Q 12.796 -1.076 12.796 -1.032 Q 12.796 -0.987999 12.792 -0.931999 L 12.792 -0.931999 L 11.14 -0.931999 L 11.14 -1.192 L 12.464 -1.192 Q 12.452 -1.468 12.282 -1.624 Q 12.112 -1.78 11.856 -1.78 L 11.856 -1.78 Q 11.688 -1.78 11.54 -1.702 Q 11.392 -1.624 11.304 -1.474 Q 11.216 -1.324 11.216 -1.1 L 11.216 -1.1 L 11.216 -0.987999 Q 11.216 -0.739999 11.306 -0.571999 Q 11.396 -0.404 11.542 -0.32 Q 11.688 -0.236 11.856 -0.236 L 11.856 -0.236 Q 12.068 -0.236 12.206 -0.33 Q 12.344 -0.424 12.408 -0.587999 L 12.408 -0.587999 L 12.74 -0.587999 Q 12.688 -0.404 12.568 -0.262 Q 12.448 -0.12 12.27 -0.036 Q 12.092 0.048 11.856 0.048 Z M 13.32 0 L 12.952 0 L 13.636 -1.008 L 12.952 -2.016 L 13.32 -2.016 L 13.864 -1.192 L 13.864 -1.192 L 14.416 -2.016 L 14.776 -2.016 L 14.092 -1.008 L 14.776 0 L 14.416 0 L 13.864 -0.827999 L 13.864 -0.827999 L 13.32 0 Z M 16.24 0 L 15.928 0 Q 15.748 0 15.616 -0.056 Q 15.484 -0.112 15.414 -0.246 Q 15.344 -0.38 15.344 -0.607999 L 15.344 -0.607999 L 15.344 -1.732 L 14.992 -1.732 L 14.992 -2.016 L 15.344 -2.016 L 15.388 -2.504 L 15.68 -2.504 L 15.68 -2.016 L 16.264 -2.016 L 16.264 -1.732 L 15.68 -1.732 L 15.68 -0.607999 Q 15.68 -0.42 15.756 -0.354 Q 15.832 -0.288 16.024 -0.288 L 16.024 -0.288 L 16.24 -0.288 L 16.24 0 Z M 18.104 0 L 17.768 0 L 17.768 -2.88 L 18.104 -2.88 L 18.104 -1.676 L 18.104 -1.676 Q 18.204 -1.856 18.386 -1.96 Q 18.568 -2.064 18.784 -2.064 L 18.784 -2.064 Q 19.016 -2.064 19.188 -1.97 Q 19.36 -1.876 19.452 -1.684 Q 19.544 -1.492 19.544 -1.2 L 19.544 -1.2 L 19.544 0 L 19.212 0 L 19.212 -1.164 Q 19.212 -1.468 19.084 -1.622 Q 18.956 -1.776 18.712 -1.776 L 18.712 -1.776 Q 18.54 -1.776 18.402 -1.692 Q 18.264 -1.608 18.184 -1.452 Q 18.104 -1.296 18.104 -1.068 L 18.104 -1.068 L 18.104 0 Z M 20.952 0.048 L 20.952 0.048 Q 20.672 0.048 20.452 -0.084 Q 20.232 -0.216 20.108 -0.454 Q 19.984 -0.691999 19.984 -1.008 L 19.984 -1.008 Q 19.984 -1.328 20.106 -1.564 Q 20.228 -1.8 20.45 -1.932 Q 20.672 -2.064 20.96 -2.064 L 20.96 -2.064 Q 21.256 -2.064 21.464 -1.932 Q 21.672 -1.8 21.782 -1.586 Q 21.892 -1.372 21.892 -1.116 L 21.892 -1.116 Q 21.892 -1.076 21.892 -1.032 Q 21.892 -0.987999 21.888 -0.931999 L 21.888 -0.931999 L 20.236 -0.931999 L 20.236 -1.192 L 21.56 -1.192 Q 21.548 -1.468 21.378 -1.624 Q 21.208 -1.78 20.952 -1.78 L 20.952 -1.78 Q 20.784 -1.78 20.636 -1.702 Q 20.488 -1.624 20.4 -1.474 Q 20.312 -1.324 20.312 -1.1 L 20.312 -1.1 L 20.312 -0.987999 Q 20.312 -0.739999 20.402 -0.571999 Q 20.492 -0.404 20.638 -0.32 Q 20.784 -0.236 20.952 -0.236 L 20.952 -0.236 Q 21.164 -0.236 21.302 -0.33 Q 21.44 -0.424 21.504 -0.587999 L 21.504 -0.587999 L 21.836 -0.587999 Q 21.784 -0.404 21.664 -0.262 Q 21.544 -0.12 21.366 -0.036 Q 21.188 0.048 20.952 0.048 Z M 22.676 0 L 22.34 0 L 22.34 -2.016 L 22.644 -2.016 L 22.668 -1.632 L 22.668 -1.632 Q 22.736 -1.768 22.842 -1.864 Q 22.948 -1.96 23.098 -2.012 Q 23.248 -2.064 23.44 -2.064 L 23.44 -2.064 L 23.44 -1.712 L 23.316 -1.712 Q 23.188 -1.712 23.072 -1.678 Q 22.956 -1.644 22.866 -1.568 Q 22.776 -1.492 22.726 -1.362 Q 22.676 -1.232 22.676 -1.04 L 22.676 -1.04 L 22.676 0 Z M 24.628 0.048 L 24.628 0.048 Q 24.348 0.048 24.128 -0.084 Q 23.908 -0.216 23.784 -0.454 Q 23.66 -0.691999 23.66 -1.008 L 23.66 -1.008 Q 23.66 -1.328 23.782 -1.564 Q 23.904 -1.8 24.126 -1.932 Q 24.348 -2.064 24.636 -2.064 L 24.636 -2.064 Q 24.932 -2.064 25.14 -1.932 Q 25.348 -1.8 25.458 -1.586 Q 25.568 -1.372 25.568 -1.116 L 25.568 -1.116 Q 25.568 -1.076 25.568 -1.032 Q 25.568 -0.987999 25.564 -0.931999 L 25.564 -0.931999 L 23.912 -0.931999 L 23.912 -1.192 L 25.236 -1.192 Q 25.224 -1.468 25.054 -1.624 Q 24.884 -1.78 24.628 -1.78 L 24.628 -1.78 Q 24.46 -1.78 24.312 -1.702 Q 24.164 -1.624 24.076 -1.474 Q 23.988 -1.324 23.988 -1.1 L 23.988 -1.1 L 23.988 -0.987999 Q 23.988 -0.739999 24.078 -0.571999 Q 24.168 -0.404 24.314 -0.32 Q 24.46 -0.236 24.628 -0.236 L 24.628 -0.236 Q 24.84 -0.236 24.978 -0.33 Q 25.116 -0.424 25.18 -0.587999 L 25.18 -0.587999 L 25.512 -0.587999 Q 25.46 -0.404 25.34 -0.262 Q 25.22 -0.12 25.042 -0.036 Q 24.864 0.048 24.628 0.048 Z"/>
                  </g>
                  
     
                  
      </svg>

  `;

  doc.addSVG(mockSvgImg, 100, 100, {
    colorMode: "RGB",
    // fontCallback: function () {
    //   // return "my-font";
    //   return undefined;
    // },
  });
  // doc.font("my-font").text("This aaa is啊啊!").moveDown(0.5);
  // doc.font("assets/NotoSansCJK-Regular.ttf").text("This is啊啊!").moveDown(0.5);
  // doc.fill([0, 0, 0, 100]).text("Here is some text...", 100, 300);
  // doc.image("./assets/output_alpha.jpg", 0, 0, {});
  doc.end();
}
init();
pdf();
