<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <meta name="theme-color" content="#ffffff">
    <title>停车位置信息记录</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f7f7f7;
        }

        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

        select,
        input[type="text"],
        input[type="time"],
        input[type="color"] {
            width: 100%;
            padding: 5vw;
            margin-bottom: 10px;
            border-radius: 4px;
            border: 1px solid #ccc;
            box-sizing: border-box;
        }

        select {
            font-size: 1rem;
        }

        #color {
            height: 10vh;
            padding: 1vw;
        }

        select {
            appearance: none;
        }

        button {
            width: 100%;
            padding: 10px;
            background-color: #007bff;
            color: #fff;
            border: none;
            border-radius: 4px;
            font-size: 16px;
            cursor: pointer;
        }

        .m-input {
            width: 100%;
            height: 5vh;
        }

        button:disabled {
            background-color: #cccccc;
        }

        h1,
        h2,
        h3 {
            margin: 0;
        }

        .result {
            position: relative;
            margin: 10px 0;
            padding: 15px;
            border-radius: 4px;
            background-color: #e9ecef;

            .reset-btn {
                position: absolute;
                right: 20px;
                top: 20px;
                cursor: pointer;
            }
        }
    </style>
</head>

<body>
    <h2>Parking Information</h2>
    <div class="result" id="result" style="display: none;">
        <h3>Last saved</h3>
        <p>楼层: <span id="result-floor"></span></p>
        <p>区域: <span id="result-area"></span></p>
        <p>停车位颜色: <span id="result-color" style="display: inline-block; width: 20px; height: 20px;"></span></p>
        <p>停车位号码: <span id="result-area-number"></span></p>
        <p>停车时间: <span id="result-time"></span></p>
        <p>备注: <span id="result-remark"></span></p>
        <div class="reset-btn" onclick="reset()">
            重置
        </div>
    </div>
    <div class="form-operation">
        <div class="form-group">
            <label for="floor">当前楼层</label>
            <select id="floor">
                <option value="B1">B1</option>
                <option value="B2">B2</option>
                <option value="B3">B3</option>
                <option value="L1">L1</option>
                <option value="L2">L2</option>
                <option value="L3">L3</option>
                <option value="L4">L4</option>
                <option value="L5">L5</option>

            </select>
        </div>

        <div class="form-group">
            <label for="area">当前停车位区域</label>
            <select id="area">
                <option value="A">A</option>
                <option value="B">B</option>
                <option value="C">C</option>
                <option value="D">D</option>
                <option value="E">E</option>
                <option value="F">F</option>
                <option value="G">G</option>
                <option value="H">H</option>
                <option value="I">I</option>
                <option value="J">J</option>
                <option value="K">K</option>
                <option value="L">L</option>
                <option value="M">M</option>
            </select>
        </div>

        <div class="form-group">
            <label for="color">设置当前停车位区域主颜色</label>
            <input type="color" id="color" value="#0000ff">
        </div>

        <div class="form-group">
            <label for="area-number">设置当前停车位号码</label>
            <input class="m-input" type="number" id="area-number" placeholder="例如：118">
        </div>
        <div class="form-group">
            <label for="remark">备注</label>
            <input class="m-input" id="remark" placeholder="额外信息">
        </div>


        <button id="save-btn" onclick="saveParkingInfo()">保存停车信息</button>

    </div>


    <script>
        let parkingInfo = {}
        let displayTimeDom = null
        const floorDom = document.getElementById('floor');
        const areaDom = document.getElementById('area');
        const colorDom = document.getElementById('color');
        const areaNumberDom = document.getElementById('area-number');
        const remarkDom = document.getElementById('remark');
        const resultDom = document.getElementById('result')
        const formDom = document.querySelector('.form-operation');
        let timer = null
        echoParkingInfo()
        function saveParkingInfo() {
            const floor = floorDom.value;
            const area = areaDom.value;
            const color = colorDom.value;
            const spotNumber = areaNumberDom.value;
            const remark = remarkDom.value;
            parkingInfo = {
                floor: floor,
                area: area,
                color: color,
                spotNumber: spotNumber,
                time: Date.parse(new Date()),
                remark: remark
            }
            localStorage.setItem('PARKING_INFO', JSON.stringify(parkingInfo))
            // 更新显示内容
            document.getElementById('result-floor').textContent = floor;
            document.getElementById('result-area').textContent = area;
            document.getElementById('result-color').style.backgroundColor = color;
            document.getElementById('result-area-number').textContent = spotNumber;
            document.getElementById('result-remark').textContent = remark;
            // 显示结果
            resultDom.style.display = 'block';
            formDom.style.display = 'none'
            updateTime()
            notify()
        }

        function echoParkingInfo() {
            const parkingInfoStr = localStorage.getItem('PARKING_INFO');
            if (parkingInfoStr) {
                parkingInfo = JSON.parse(parkingInfoStr);
                document.getElementById('result-floor').textContent = parkingInfo.floor;
                document.getElementById('result-area').textContent = parkingInfo.area;
                document.getElementById('result-color').style.backgroundColor = parkingInfo.color;
                document.getElementById('result-area-number').textContent = parkingInfo.spotNumber;
                resultDom.style.display = 'block';
                updateTime()

            }

        }
        function getParkedTime() {
            const parkedTime = new Date();
            const pastTime = parkedTime - parkingInfo.time;
            console.log(parkingInfo);
            // 显示时间 hh-mm-ss
            const hour = Math.floor(pastTime / 1000 / 60 / 60);
            const minute = Math.floor(pastTime / 1000 / 60) % 60;
            const second = Math.floor(pastTime / 1000) % 60;
            const displayTime = `${hour < 10 ? '0' + hour : hour}:${minute < 10 ? '0' + minute : minute}:${second < 10 ? '0' + second : second}`
            displayTimeDom.innerText = displayTime;
        }
        function updateTime() {
            displayTimeDom = document.getElementById('result-time');
            timer = setInterval(() => {
                getParkedTime()
            }, 1000);
        }
        function reset() {
            localStorage.removeItem('PARKING_INFO')
            resultDom.style.display = 'none';
            formDom.style.display = 'block'

            parkingInfo = {}
            clearInterval(timer)
        }
        function notify() {
            fetch('http://cc.mingo.wang:3123/notify')
        }

    </script>
</body>

</html>